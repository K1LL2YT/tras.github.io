<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KLZ Aced Tournament</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />

  <style>
    body {
      background: #0d0d0d;
      color: #eee;
      font-family: 'Segoe UI', sans-serif;
    }

    h1 {
      font-size: 3.5rem;
      font-weight: 900;
      color: #ffb400;
      text-shadow: 0 0 8px #ffb400aa;
      margin-top: 1rem;
      animation: fadeInDown 1s ease-out;
    }

    .lead {
      color: #ccc;
      font-size: 1.3rem;
      animation: fadeInDown 1.2s ease-out;
    }

    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .nav-tabs .nav-link.active {
      background-color: #1f1f1f;
      border-color: #444 #444 #0d0d0d;
      color: #ffb400;
      font-weight: 700;
      font-size: 1.1rem;
    }

    .nav-tabs .nav-link {
      color: #bbb;
      font-weight: 600;
      font-size: 1.05rem;
      transition: color 0.3s;
    }

    .nav-tabs .nav-link:hover {
      color: #ffb400;
    }

    table {
      background: #121212;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 0 20px #ffb40055;
      font-size: 1.1rem;
      animation: fadeInUp 1s ease-out;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    thead {
      background: #222;
      color: #ffb400;
    }

    tbody tr:hover {
      background-color: #2a2a2a;
    }

    .avatar {
      width: 65px;
      height: 65px;
      border-radius: 50%;
      border: 3px solid #ffb400;
      margin-right: 0.75rem;
      transition: transform 0.3s ease;
    }

    .avatar:hover {
      transform: scale(1.1);
      border-color: white;
    }

    .rank-badge {
      font-size: 1.5rem;
      vertical-align: middle;
      margin-left: 8px;
    }

    .rank-1 { color: #ffd700; text-shadow: 0 0 6px #ffd700aa; }
    .rank-2 { color: #c0c0c0; text-shadow: 0 0 6px #c0c0c0aa; }
    .rank-3 { color: #cd7f32; text-shadow: 0 0 6px #cd7f32aa; }

    .podium {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 2rem 0;
      animation: fadeInUp 1.3s ease-out;
    }

    .podium-spot {
      text-align: center;
      padding: 1rem;
      background: linear-gradient(to top, #1a1a1a, #2a2a2a);
      border-radius: 12px;
      box-shadow: 0 0 15px #ffb40066;
      width: 150px;
      position: relative;
      transform: scale(1);
      transition: transform 0.3s ease;
    }

    .podium-spot:hover {
      transform: scale(1.05);
    }

    .podium-1 {
      order: 2;
      background-color: #ffd70022;
      border-top: 6px solid #ffd700;
    }

    .podium-2 {
      order: 1;
      background-color: #c0c0c022;
      border-top: 6px solid #c0c0c0;
    }

    .podium-3 {
      order: 3;
      background-color: #cd7f3222;
      border-top: 6px solid #cd7f32;
    }

    .podium img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 4px solid white;
      margin-bottom: 0.5rem;
    }

    .podium h4 {
      font-weight: 800;
      font-size: 1.1rem;
      color: #ffb400;
    }

    .tab-pane {
      margin-top: 2rem;
    }
  </style>
</head>

<body class="container py-4">
  <h1><i class="bi bi-controller"></i> KLZ Aced Tournament</h1>
  <p class="lead">Fun. Competitive. Chaotic. Open to all players. Hosted by RobloxKLZ.</p>

  <ul class="nav nav-tabs mt-4" id="tabs" role="tablist">
    <li class="nav-item">
      <button class="nav-link active" id="leaderboard-tab" data-bs-toggle="tab" data-bs-target="#leaderboard" type="button">üìä Leaderboard</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" id="bracket-tab" data-bs-toggle="tab" data-bs-target="#bracket" type="button">üèÜ Bracket</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" id="games-tab" data-bs-toggle="tab" data-bs-target="#games" type="button">üïπÔ∏è Games</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" id="schedule-tab" data-bs-toggle="tab" data-bs-target="#schedule" type="button">üóìÔ∏è Schedule</button>
    </li>
  </ul>

  <div class="tab-content">
    <div class="tab-pane fade show active" id="leaderboard">
      <h3 class="text-center mt-4">ü•á Top 3 Podium</h3>
      <div class="podium" id="podium"></div>

      <h3 class="text-center mt-5">üìä Full Leaderboard</h3>
      <table class="table table-dark table-hover align-middle mt-3" id="leaderboard-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Player</th>
            <th>Game Wins</th>
            <th>Tourney Wins</th>
            <th>Placements</th>
            <th>Losses</th>
            <th>Elo</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="tab-pane fade" id="bracket"><h3>üèÜ Bracket</h3><p>Insert Challonge or bracket system here.</p></div>
    <div class="tab-pane fade" id="games"><h3>üïπÔ∏è Games</h3><p>Games list here.</p></div>
    <div class="tab-pane fade" id="schedule"><h3>üóìÔ∏è Schedule</h3><p>Schedule goes here.</p></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT2_wr_BqYz609qT5ajqqg7Dc9GIg0Y1fC9u26LnDWFuZbs_ItQfiRigpXkywopq5K4LuSRR25FaBAw/pub?output=csv";

    async function getUserId(username) {
      try {
        const response = await fetch(`https://api.roblox.com/users/get-by-username?username=${encodeURIComponent(username)}`);
        const data = await response.json();
        return data && data.Id ? data.Id : 0;
      } catch {
        return 0;
      }
    }

    async function loadLeaderboard() {
      const res = await fetch(sheetURL);
      const csv = await res.text();
      const lines = csv.trim().split("\n");
      const data = lines.slice(1).map(l => l.split(","));

      const players = await Promise.all(data.map(async ([name, user, wins, tWins, place, loss, elo, avatar]) => {
        const id = isNaN(user) ? await getUserId(user) : user;
        return {
          name,
          id,
          avatar: avatar || `https://www.roblox.com/headshot-thumbnail/image?userId=${id}&width=100&height=100&format=png`,
          wins: +wins,
          tWins: +tWins,
          place: +place,
          loss: +loss,
          elo: +elo || (+wins * 10 + +tWins * 25 + +place * 15 - +loss * 5),
        };
      }));

      players.sort((a, b) => b.elo - a.elo);

      const podium = document.getElementById("podium");
      ["podium-2", "podium-1", "podium-3"].forEach((cls, i) => {
        const p = players[i];
        const div = document.createElement("div");
        div.className = `podium-spot ${cls}`;
        div.innerHTML = `
          <img src="${p.avatar}" alt="${p.name}" />
          <h4>${p.name}</h4>
          <p>Elo: ${p.elo}</p>
        `;
        podium.appendChild(div);
      });

      const tbody = document.querySelector("#leaderboard-table tbody");
      players.forEach((p, i) => {
        const tr = document.createElement("tr");
        const badge = i === 0 ? "rank-1" : i === 1 ? "rank-2" : i === 2 ? "rank-3" : "";
        tr.innerHTML = `
          <td>${i + 1} ${badge ? `<i class="bi bi-award-fill ${badge}"></i>` : ""}</td>
          <td><img src="${p.avatar}" class="avatar" /> <a class="text-warning" target="_blank" href="https://roblox.com/users/${p.id}/profile">${p.name}</a></td>
          <td>${p.wins}</td>
          <td>${p.tWins}</td>
          <td>${p.place}</td>
          <td>${p.loss}</td>
          <td>${p.elo}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    loadLeaderboard();
  </script>
</body>
</html>
